<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/FavoritesRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/FavoritesRepository.kt" />
              <option name="updatedContent" value="package com.example.level_up_app.data&#10;&#10;import androidx.compose.runtime.mutableStateListOf&#10;&#10;object FavoritesRepository {&#10;    private val _favorites = mutableStateListOf&lt;Product&gt;()&#10;    val favorites: List&lt;Product&gt; get() = _favorites&#10;&#10;    fun addToFavorites(product: Product) {&#10;        // Verificar si el producto ya está en favoritos&#10;        if (!_favorites.any { it.id == product.id }) {&#10;            _favorites.add(product)&#10;        }&#10;    }&#10;&#10;    fun removeFromFavorites(productId: String) {&#10;        _favorites.removeAll { it.id == productId }&#10;    }&#10;&#10;    fun isFavorite(productId: String): Boolean {&#10;        return _favorites.any { it.id == productId }&#10;    }&#10;&#10;    fun toggleFavorite(product: Product) {&#10;        if (isFavorite(product.id)) {&#10;            removeFromFavorites(product.id)&#10;        } else {&#10;            addToFavorites(product)&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/model/CreateUserRequest.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/model/CreateUserRequest.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.data.model&#10;&#10;import kotlinx.serialization.Serializable&#10;&#10;/**&#10; * DTO para crear un nuevo usuario.&#10; * Solo contiene los campos requeridos por el backend.&#10; */&#10;@Serializable&#10;data class CreateUserRequest(&#10;    val name: String,&#10;    val email: String,&#10;    val clave: String&#10;)&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/model/User.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/model/User.kt" />
              <option name="originalContent" value="package com.example.level_up_app.data.model&#10;&#10;import kotlinx.serialization.Serializable&#10;&#10;@Serializable&#10;data class User(&#10;    val id: Int? = null,&#10;    val username: String,  // Cambiado de 'name' a 'username' para coincidir con backend&#10;    val email: String,&#10;    val password: String,  // Cambiado de 'clave' a 'password' para coincidir con backend&#10;    val isAdmin: Boolean = false,&#10;    val createdAt: String? = null&#10;)&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.data.model&#10;&#10;import kotlinx.serialization.Serializable&#10;&#10;@Serializable&#10;data class User(&#10;    val id: Int? = null,&#10;    val name: String,&#10;    val email: String,&#10;    val clave: String,&#10;    val isAdmin: Boolean = false,&#10;    val createdAt: String? = null&#10;)&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/network/ApiService.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/network/ApiService.kt" />
              <option name="originalContent" value="package com.example.level_up_app.data.network&#10;&#10;import com.example.level_up_app.data.model.*&#10;import retrofit2.Response&#10;import retrofit2.http.*&#10;&#10;interface ApiService {&#10;    // USUARIOS&#10;    @GET(&quot;users&quot;)&#10;    suspend fun getAllUsers(): Response&lt;List&lt;User&gt;&gt;&#10;&#10;    @GET(&quot;users/{id}&quot;)&#10;    suspend fun getUserById(@Path(&quot;id&quot;) id: Int): Response&lt;User&gt;&#10;&#10;    @GET(&quot;users/email/{email}&quot;)&#10;    suspend fun getUserByEmail(@Path(&quot;email&quot;) email: String): Response&lt;User&gt;&#10;&#10;    @POST(&quot;users&quot;)&#10;    suspend fun createUser(@Body user: User): Response&lt;User&gt;&#10;&#10;    @PUT(&quot;users/{id}&quot;)&#10;    suspend fun updateUser(@Path(&quot;id&quot;) id: Int, @Body user: User): Response&lt;User&gt;&#10;&#10;    @DELETE(&quot;users/{id}&quot;)&#10;    suspend fun deleteUser(@Path(&quot;id&quot;) id: Int): Response&lt;Unit&gt;&#10;&#10;    // PRODUCTOS&#10;    @GET(&quot;products&quot;)&#10;    suspend fun getAllProducts(): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @GET(&quot;products/{id}&quot;)&#10;    suspend fun getProductById(@Path(&quot;id&quot;) id: Int): Response&lt;Product&gt;&#10;&#10;    @GET(&quot;products/category/{categoryId}&quot;)&#10;    suspend fun getProductsByCategory(@Path(&quot;categoryId&quot;) categoryId: Int): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @GET(&quot;products/search/{title}&quot;)&#10;    suspend fun searchProducts(@Path(&quot;title&quot;) title: String): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @POST(&quot;products&quot;)&#10;    suspend fun createProduct(@Body product: Product): Response&lt;Product&gt;&#10;&#10;    @PUT(&quot;products/{id}&quot;)&#10;    suspend fun updateProduct(@Path(&quot;id&quot;) id: Int, @Body product: Product): Response&lt;Product&gt;&#10;&#10;    @DELETE(&quot;products/{id}&quot;)&#10;    suspend fun deleteProduct(@Path(&quot;id&quot;) id: Int): Response&lt;Unit&gt;&#10;&#10;    // CATEGORÍAS&#10;    @GET(&quot;categories&quot;)&#10;    suspend fun getAllCategories(): Response&lt;List&lt;Category&gt;&gt;&#10;&#10;    @GET(&quot;categories/{id}&quot;)&#10;    suspend fun getCategoryById(@Path(&quot;id&quot;) id: Int): Response&lt;Category&gt;&#10;&#10;    @POST(&quot;categories&quot;)&#10;    suspend fun createCategory(@Body category: Category): Response&lt;Category&gt;&#10;&#10;    // ÓRDENES&#10;    @GET(&quot;orders&quot;)&#10;    suspend fun getAllOrders(): Response&lt;List&lt;Order&gt;&gt;&#10;&#10;    @GET(&quot;orders/{id}&quot;)&#10;    suspend fun getOrderById(@Path(&quot;id&quot;) id: Int): Response&lt;Order&gt;&#10;&#10;    @GET(&quot;orders/user/{userId}&quot;)&#10;    suspend fun getOrdersByUser(@Path(&quot;userId&quot;) userId: Int): Response&lt;List&lt;Order&gt;&gt;&#10;&#10;    @POST(&quot;orders&quot;)&#10;    suspend fun createOrder(@Body order: Order): Response&lt;Order&gt;&#10;&#10;    @PUT(&quot;orders/{id}&quot;)&#10;    suspend fun updateOrder(@Path(&quot;id&quot;) id: Int, @Body order: Order): Response&lt;Order&gt;&#10;&#10;    // FAVORITOS&#10;    @GET(&quot;favorites/user/{userId}&quot;)&#10;    suspend fun getFavoritesByUser(@Path(&quot;userId&quot;) userId: Int): Response&lt;List&lt;Favorite&gt;&gt;&#10;&#10;    @POST(&quot;favorites&quot;)&#10;    suspend fun addFavorite(@Body favorite: Favorite): Response&lt;Favorite&gt;&#10;&#10;    @DELETE(&quot;favorites/{userId}/{productId}&quot;)&#10;    suspend fun removeFavorite(&#10;        @Path(&quot;userId&quot;) userId: Int,&#10;        @Path(&quot;productId&quot;) productId: Int&#10;    ): Response&lt;Unit&gt;&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.data.network&#10;&#10;import com.example.level_up_app.data.model.*&#10;import retrofit2.Response&#10;import retrofit2.http.*&#10;&#10;interface ApiService {&#10;    // USUARIOS&#10;    @GET(&quot;users&quot;)&#10;    suspend fun getAllUsers(): Response&lt;List&lt;User&gt;&gt;&#10;&#10;    @GET(&quot;users/{id}&quot;)&#10;    suspend fun getUserById(@Path(&quot;id&quot;) id: Int): Response&lt;User&gt;&#10;&#10;    @GET(&quot;users/email/{email}&quot;)&#10;    suspend fun getUserByEmail(@Path(&quot;email&quot;) email: String): Response&lt;User&gt;&#10;&#10;    @POST(&quot;users&quot;)&#10;    suspend fun createUser(@Body user: User): Response&lt;User&gt;&#10;&#10;    @POST(&quot;users&quot;)&#10;    suspend fun createUserWithRequest(@Body request: CreateUserRequest): Response&lt;User&gt;&#10;&#10;    @PUT(&quot;users/{id}&quot;)&#10;    suspend fun updateUser(@Path(&quot;id&quot;) id: Int, @Body user: User): Response&lt;User&gt;&#10;&#10;    @DELETE(&quot;users/{id}&quot;)&#10;    suspend fun deleteUser(@Path(&quot;id&quot;) id: Int): Response&lt;Unit&gt;&#10;&#10;    // PRODUCTOS&#10;    @GET(&quot;products&quot;)&#10;    suspend fun getAllProducts(): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @GET(&quot;products/{id}&quot;)&#10;    suspend fun getProductById(@Path(&quot;id&quot;) id: Int): Response&lt;Product&gt;&#10;&#10;    @GET(&quot;products/category/{categoryId}&quot;)&#10;    suspend fun getProductsByCategory(@Path(&quot;categoryId&quot;) categoryId: Int): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @GET(&quot;products/search/{title}&quot;)&#10;    suspend fun searchProducts(@Path(&quot;title&quot;) title: String): Response&lt;List&lt;Product&gt;&gt;&#10;&#10;    @POST(&quot;products&quot;)&#10;    suspend fun createProduct(@Body product: Product): Response&lt;Product&gt;&#10;&#10;    @PUT(&quot;products/{id}&quot;)&#10;    suspend fun updateProduct(@Path(&quot;id&quot;) id: Int, @Body product: Product): Response&lt;Product&gt;&#10;&#10;    @DELETE(&quot;products/{id}&quot;)&#10;    suspend fun deleteProduct(@Path(&quot;id&quot;) id: Int): Response&lt;Unit&gt;&#10;&#10;    // CATEGORÍAS&#10;    @GET(&quot;categories&quot;)&#10;    suspend fun getAllCategories(): Response&lt;List&lt;Category&gt;&gt;&#10;&#10;    @GET(&quot;categories/{id}&quot;)&#10;    suspend fun getCategoryById(@Path(&quot;id&quot;) id: Int): Response&lt;Category&gt;&#10;&#10;    @POST(&quot;categories&quot;)&#10;    suspend fun createCategory(@Body category: Category): Response&lt;Category&gt;&#10;&#10;    // ÓRDENES&#10;    @GET(&quot;orders&quot;)&#10;    suspend fun getAllOrders(): Response&lt;List&lt;Order&gt;&gt;&#10;&#10;    @GET(&quot;orders/{id}&quot;)&#10;    suspend fun getOrderById(@Path(&quot;id&quot;) id: Int): Response&lt;Order&gt;&#10;&#10;    @GET(&quot;orders/user/{userId}&quot;)&#10;    suspend fun getOrdersByUser(@Path(&quot;userId&quot;) userId: Int): Response&lt;List&lt;Order&gt;&gt;&#10;&#10;    @POST(&quot;orders&quot;)&#10;    suspend fun createOrder(@Body order: Order): Response&lt;Order&gt;&#10;&#10;    @PUT(&quot;orders/{id}&quot;)&#10;    suspend fun updateOrder(@Path(&quot;id&quot;) id: Int, @Body order: Order): Response&lt;Order&gt;&#10;&#10;    // FAVORITOS&#10;    @GET(&quot;favorites/user/{userId}&quot;)&#10;    suspend fun getFavoritesByUser(@Path(&quot;userId&quot;) userId: Int): Response&lt;List&lt;Favorite&gt;&gt;&#10;&#10;    @POST(&quot;favorites&quot;)&#10;    suspend fun addFavorite(@Body favorite: Favorite): Response&lt;Favorite&gt;&#10;&#10;    @DELETE(&quot;favorites/{userId}/{productId}&quot;)&#10;    suspend fun removeFavorite(&#10;        @Path(&quot;userId&quot;) userId: Int,&#10;        @Path(&quot;productId&quot;) productId: Int&#10;    ): Response&lt;Unit&gt;&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/network/RetrofitClient.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/network/RetrofitClient.kt" />
              <option name="originalContent" value="package com.example.level_up_app.data.network&#10;&#10;import com.jakewharton.retrofit2.converter.kotlinx.serialization.asConverterFactory&#10;import kotlinx.serialization.json.Json&#10;import okhttp3.MediaType.Companion.toMediaType&#10;import okhttp3.OkHttpClient&#10;import okhttp3.logging.HttpLoggingInterceptor&#10;import retrofit2.Retrofit&#10;import java.util.concurrent.TimeUnit&#10;&#10;object RetrofitClient {&#10;    private const val BASE_URL = &quot;http://10.0.2.2:8080/api/&quot;&#10;&#10;    private val json = Json {&#10;        ignoreUnknownKeys = true&#10;        isLenient = true&#10;        coerceInputValues = true&#10;    }&#10;&#10;    private val loggingInterceptor = HttpLoggingInterceptor().apply {&#10;        level = HttpLoggingInterceptor.Level.BODY&#10;    }&#10;&#10;    private val okHttpClient = OkHttpClient.Builder()&#10;        .addInterceptor(loggingInterceptor)&#10;        .connectTimeout(30, TimeUnit.SECONDS)&#10;        .readTimeout(30, TimeUnit.SECONDS)&#10;        .writeTimeout(30, TimeUnit.SECONDS)&#10;        .build()&#10;&#10;    private val retrofit = Retrofit.Builder()&#10;        .baseUrl(BASE_URL)&#10;        .client(okHttpClient)&#10;        .addConverterFactory(json.asConverterFactory(&quot;application/json&quot;.toMediaType()))&#10;        .build()&#10;&#10;    val apiService: ApiService = retrofit.create(ApiService::class.java)&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.data.network&#10;&#10;import android.util.Log&#10;import com.jakewharton.retrofit2.converter.kotlinx.serialization.asConverterFactory&#10;import kotlinx.serialization.json.Json&#10;import okhttp3.MediaType.Companion.toMediaType&#10;import okhttp3.OkHttpClient&#10;import okhttp3.logging.HttpLoggingInterceptor&#10;import retrofit2.Retrofit&#10;import java.util.concurrent.TimeUnit&#10;&#10;object RetrofitClient {&#10;    // URL para el emulador de Android (10.0.2.2 apunta a localhost del host)&#10;    // Si usas dispositivo físico, cambia a la IP de tu computadora&#10;    private const val BASE_URL = &quot;http://10.0.2.2:8080/api/&quot;&#10;&#10;    init {&#10;        Log.d(&quot;RetrofitClient&quot;, &quot; URL Base configurada: $BASE_URL&quot;)&#10;        Log.d(&quot;RetrofitClient&quot;, &quot; Endpoint para crear usuario: ${BASE_URL}users&quot;)&#10;    }&#10;&#10;    private val json = Json {&#10;        ignoreUnknownKeys = true&#10;        isLenient = true&#10;        coerceInputValues = true&#10;    }&#10;&#10;    private val loggingInterceptor = HttpLoggingInterceptor().apply {&#10;        level = HttpLoggingInterceptor.Level.BODY&#10;    }&#10;&#10;    private val okHttpClient = OkHttpClient.Builder()&#10;        .addInterceptor(loggingInterceptor)&#10;        .connectTimeout(30, TimeUnit.SECONDS)&#10;        .readTimeout(30, TimeUnit.SECONDS)&#10;        .writeTimeout(30, TimeUnit.SECONDS)&#10;        .build()&#10;&#10;    private val retrofit = Retrofit.Builder()&#10;        .baseUrl(BASE_URL)&#10;        .client(okHttpClient)&#10;        .addConverterFactory(json.asConverterFactory(&quot;application/json&quot;.toMediaType()))&#10;        .build()&#10;&#10;    val apiService: ApiService = retrofit.create(ApiService::class.java)&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/repository/UserRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/data/repository/UserRepository.kt" />
              <option name="originalContent" value="package com.example.level_up_app.data.repository&#10;&#10;import com.example.level_up_app.data.model.User&#10;import com.example.level_up_app.data.network.RetrofitClient&#10;&#10;class UserRepository {&#10;    private val api = RetrofitClient.apiService&#10;&#10;    suspend fun getAllUsers(): Result&lt;List&lt;User&gt;&gt; = runCatching {&#10;        val response = api.getAllUsers()&#10;        if (!response.isSuccessful) error(&quot;HTTP ${response.code()}&quot;)&#10;        response.body() ?: error(&quot;Empty body&quot;)&#10;    }&#10;&#10;    suspend fun createUser(user: User): Result&lt;User&gt; = runCatching {&#10;        val response = api.createUser(user)&#10;        if (!response.isSuccessful) error(&quot;HTTP ${response.code()}&quot;)&#10;        response.body() ?: error(&quot;Empty body&quot;)&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.data.repository&#10;&#10;import android.util.Log&#10;import com.example.level_up_app.data.model.CreateUserRequest&#10;import com.example.level_up_app.data.model.User&#10;import com.example.level_up_app.data.network.RetrofitClient&#10;&#10;class UserRepository {&#10;    private val api = RetrofitClient.apiService&#10;    private val TAG = &quot;UserRepository&quot;&#10;&#10;    suspend fun getAllUsers(): Result&lt;List&lt;User&gt;&gt; = runCatching {&#10;        val response = api.getAllUsers()&#10;        if (!response.isSuccessful) {&#10;            Log.e(TAG, &quot;Error getAllUsers: HTTP ${response.code()} - ${response.message()}&quot;)&#10;            error(&quot;HTTP ${response.code()}: ${response.message()}&quot;)&#10;        }&#10;        response.body() ?: error(&quot;Empty body&quot;)&#10;    }&#10;&#10;    suspend fun createUser(user: User): Result&lt;User&gt; = runCatching {&#10;        Log.d(TAG, &quot; Enviando POST a http://localhost:8080/api/users&quot;)&#10;        Log.d(TAG, &quot; Usuario original: $user&quot;)&#10;        &#10;        // Crear el DTO con solo los campos requeridos&#10;        val request = CreateUserRequest(&#10;            name = user.name,&#10;            email = user.email,&#10;            clave = user.clave&#10;        )&#10;        &#10;        Log.d(TAG, &quot; Request DTO: $request&quot;)&#10;        Log.d(TAG, &quot; JSON exacto a enviar: {\&quot;name\&quot;:\&quot;${request.name}\&quot;,\&quot;email\&quot;:\&quot;${request.email}\&quot;,\&quot;clave\&quot;:\&quot;${request.clave}\&quot;}&quot;)&#10;        &#10;        val response = api.createUserWithRequest(request)&#10;&#10;        Log.d(TAG, &quot; Respuesta recibida - Status: ${response.code()}&quot;)&#10;&#10;        if (!response.isSuccessful) {&#10;            // Leer errorBody una sola vez&#10;            val errorBody = response.errorBody()?.string() ?: &quot;Sin detalles&quot;&#10;            Log.e(TAG, &quot;❌ Error createUser: HTTP ${response.code()} - ${response.message()}&quot;)&#10;            Log.e(TAG, &quot;❌ Error body completo: $errorBody&quot;)&#10;            Log.e(TAG, &quot;❌ Headers de respuesta: ${response.headers()}&quot;)&#10;            error(&quot;HTTP ${response.code()}: $errorBody&quot;)&#10;        }&#10;&#10;        val createdUser = response.body() ?: error(&quot;Empty body&quot;)&#10;        Log.d(TAG, &quot;✅ Usuario creado exitosamente: $createdUser&quot;)&#10;        createdUser&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/login/CreateAccountViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/login/CreateAccountViewModel.kt" />
              <option name="originalContent" value="package com.example.level_up_app.ui.login&#10;&#10;import android.util.Patterns&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;import java.text.SimpleDateFormat&#10;import java.util.Calendar&#10;import java.util.Locale&#10;&#10;class CreateAccountViewModel : ViewModel() {&#10;    private val formuCreateAccount = MutableStateFlow(FormularioCreateAccount())&#10;&#10;    val FormData: StateFlow&lt;FormularioCreateAccount&gt; = formuCreateAccount.asStateFlow()&#10;&#10;    fun actualizarName(name: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            name = name&#10;        )&#10;    }&#10;&#10;    fun actualizarEmail(email: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            email = email&#10;        )&#10;    }&#10;&#10;    fun actualizarPassword(pass: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            password = pass&#10;        )&#10;    }&#10;&#10;    fun actualizarDob(dob: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            dob = dob&#10;        )&#10;    }&#10;&#10;    private fun validarEmail(email: String): Boolean{&#10;        return Patterns.EMAIL_ADDRESS.matcher(email).matches()&#10;    }&#10;&#10;    private fun errorNull(){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            error = null,&#10;        )&#10;    }&#10;&#10;    private fun mensajeError(mensaje: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            error = mensaje,&#10;            isAccountCreated = false&#10;        )&#10;    }&#10;&#10;    private fun calcularEdad(fechaNacimiento: String): Int {&#10;        return try {&#10;            val formato = SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault())&#10;            val fechaNac = formato.parse(fechaNacimiento) ?: return 0&#10;&#10;            val calNacimiento = Calendar.getInstance()&#10;            calNacimiento.time = fechaNac&#10;&#10;            val calHoy = Calendar.getInstance()&#10;&#10;            var edad = calHoy.get(Calendar.YEAR) - calNacimiento.get(Calendar.YEAR)&#10;&#10;            // Ajustar si no ha cumplido años este año&#10;            if (calHoy.get(Calendar.DAY_OF_YEAR) &lt; calNacimiento.get(Calendar.DAY_OF_YEAR)) {&#10;                edad--&#10;            }&#10;&#10;            edad&#10;        } catch (e: Exception) {&#10;            0&#10;        }&#10;    }&#10;&#10;    fun CreateAccount(){&#10;        viewModelScope.launch {&#10;            val f = formuCreateAccount.value&#10;&#10;            // Validar nombre&#10;            if(f.name.isEmpty()){&#10;                mensajeError(&quot;El nombre es requerido&quot;)&#10;                return@launch&#10;            }else if(f.name.length &lt; 3){&#10;                mensajeError(&quot;El nombre debe tener al menos 3 caracteres&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            // Validar email&#10;            if(f.email.length &lt; 6){&#10;                mensajeError(&quot;El email es muy pequeño&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            if(!validarEmail(f.email)){&#10;                mensajeError(&quot;No tiene formato de email&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            // Validar contraseña (igual o mayor a 5 caracteres)&#10;            if (f.password.length &gt;= 5){&#10;                errorNull()&#10;            }else{&#10;                mensajeError(&quot;La contraseña debe tener al menos 5 caracteres&quot;)&#10;                return@launch&#10;            }&#10;&#10;            // Validar fecha de nacimiento&#10;            if(f.dob.isEmpty() || f.dob == &quot;Seleccionar&quot;){&#10;                mensajeError(&quot;Debe seleccionar una fecha de nacimiento&quot;)&#10;                return@launch&#10;            }&#10;&#10;            // Validar edad mayor a 18 años&#10;            val edad = calcularEdad(f.dob)&#10;            if(edad &lt; 18){&#10;                mensajeError(&quot;Debes tener al menos 18 años para crear una cuenta&quot;)&#10;                return@launch&#10;            }&#10;&#10;            errorNull()&#10;&#10;            // Si no hay errores, crear cuenta&#10;            if (f.error == null){&#10;                formuCreateAccount.value = formuCreateAccount.value.copy(&#10;                    error = &quot;&quot;,&#10;                    isAccountCreated = true&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.ui.login&#10;&#10;import android.util.Log&#10;import android.util.Patterns&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.level_up_app.data.model.User&#10;import com.example.level_up_app.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;import java.text.SimpleDateFormat&#10;import java.util.Calendar&#10;import java.util.Locale&#10;&#10;class CreateAccountViewModel : ViewModel() {&#10;    private val formuCreateAccount = MutableStateFlow(FormularioCreateAccount())&#10;    private val userRepository = UserRepository()&#10;    private val TAG = &quot;CreateAccountViewModel&quot;&#10;&#10;    val FormData: StateFlow&lt;FormularioCreateAccount&gt; = formuCreateAccount.asStateFlow()&#10;&#10;    fun actualizarName(name: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            name = name&#10;        )&#10;    }&#10;&#10;    fun actualizarEmail(email: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            email = email&#10;        )&#10;    }&#10;&#10;    fun actualizarPassword(pass: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            password = pass&#10;        )&#10;    }&#10;&#10;    fun actualizarDob(dob: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            dob = dob&#10;        )&#10;    }&#10;&#10;    private fun validarEmail(email: String): Boolean{&#10;        return Patterns.EMAIL_ADDRESS.matcher(email).matches()&#10;    }&#10;&#10;    private fun errorNull(){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            error = null,&#10;        )&#10;    }&#10;&#10;    private fun mensajeError(mensaje: String){&#10;        formuCreateAccount.value = formuCreateAccount.value.copy(&#10;            error = mensaje,&#10;            isAccountCreated = false&#10;        )&#10;    }&#10;&#10;    private fun calcularEdad(fechaNacimiento: String): Int {&#10;        return try {&#10;            val formato = SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault())&#10;            val fechaNac = formato.parse(fechaNacimiento) ?: return 0&#10;&#10;            val calNacimiento = Calendar.getInstance()&#10;            calNacimiento.time = fechaNac&#10;&#10;            val calHoy = Calendar.getInstance()&#10;&#10;            var edad = calHoy.get(Calendar.YEAR) - calNacimiento.get(Calendar.YEAR)&#10;&#10;            // Ajustar si no ha cumplido años este año&#10;            if (calHoy.get(Calendar.DAY_OF_YEAR) &lt; calNacimiento.get(Calendar.DAY_OF_YEAR)) {&#10;                edad--&#10;            }&#10;&#10;            edad&#10;        } catch (e: Exception) {&#10;            0&#10;        }&#10;    }&#10;&#10;    fun CreateAccount(){&#10;        viewModelScope.launch {&#10;            val f = formuCreateAccount.value&#10;&#10;            Log.d(TAG, &quot;Iniciando validación de cuenta...&quot;)&#10;&#10;            // Validar nombre&#10;            if(f.name.isEmpty()){&#10;                mensajeError(&quot;El nombre es requerido&quot;)&#10;                return@launch&#10;            }else if(f.name.length &lt; 3){&#10;                mensajeError(&quot;El nombre debe tener al menos 3 caracteres&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            // Validar email&#10;            if(f.email.length &lt; 6){&#10;                mensajeError(&quot;El email es muy pequeño&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            if(!validarEmail(f.email)){&#10;                mensajeError(&quot;No tiene formato de email&quot;)&#10;                return@launch&#10;            }else{&#10;                errorNull()&#10;            }&#10;&#10;            // Validar contraseña (igual o mayor a 5 caracteres)&#10;            if (f.password.length &gt;= 5){&#10;                errorNull()&#10;            }else{&#10;                mensajeError(&quot;La contraseña debe tener al menos 5 caracteres&quot;)&#10;                return@launch&#10;            }&#10;&#10;            // Validar fecha de nacimiento&#10;            if(f.dob.isEmpty() || f.dob == &quot;Seleccionar&quot;){&#10;                mensajeError(&quot;Debe seleccionar una fecha de nacimiento&quot;)&#10;                return@launch&#10;            }&#10;&#10;            // Validar edad mayor a 18 años&#10;            val edad = calcularEdad(f.dob)&#10;            if(edad &lt; 18){&#10;                mensajeError(&quot;Debes tener al menos 18 años para crear una cuenta&quot;)&#10;                return@launch&#10;            }&#10;&#10;            errorNull()&#10;&#10;            // Si no hay errores, crear usuario en el backend&#10;            Log.d(TAG, &quot;Validación exitosa, enviando usuario al backend...&quot;)&#10;            &#10;            // Crear objeto User con los datos del formulario&#10;            val newUser = User(&#10;                name = f.name,&#10;                email = f.email,&#10;                clave = f.password,&#10;                isAdmin = false&#10;            )&#10;            &#10;            Log.d(TAG, &quot;Usuario a enviar: $newUser&quot;)&#10;            Log.d(TAG, &quot;JSON que se enviará: {\&quot;name\&quot;:\&quot;${f.name}\&quot;,\&quot;email\&quot;:\&quot;${f.email}\&quot;,\&quot;clave\&quot;:\&quot;${f.password}\&quot;}&quot;)&#10;            &#10;            // Llamar al repositorio para crear el usuario&#10;            userRepository.createUser(newUser)&#10;                .onSuccess { createdUser -&gt;&#10;                    Log.d(TAG, &quot;✅ Usuario creado exitosamente: $createdUser&quot;)&#10;                    formuCreateAccount.value = formuCreateAccount.value.copy(&#10;                        error = &quot;&quot;,&#10;                        isAccountCreated = true&#10;                    )&#10;                }&#10;                .onFailure { error -&gt;&#10;                    Log.e(TAG, &quot;❌ Error al crear usuario: ${error.message}&quot;, error)&#10;                    mensajeError(&quot;Error al crear cuenta: ${error.message}&quot;)&#10;                }&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/screen/UserScreens.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/screen/UserScreens.kt" />
              <option name="originalContent" value="package com.example.level_up_app.ui.screen&#10;&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.level_up_app.ui.viewmodel.UserUiState&#10;import com.example.level_up_app.ui.viewmodel.UserViewModel&#10;&#10;@Composable&#10;fun UserListScreen(viewModel: UserViewModel = viewModel()) {&#10;    val state by viewModel.state.collectAsState()&#10;&#10;    LaunchedEffect(Unit) { viewModel.loadUsers() }&#10;&#10;    when (val s = state) {&#10;        is UserUiState.Idle -&gt; Text(&quot;Cargando usuarios...&quot;)&#10;        is UserUiState.Loading -&gt; CircularProgressIndicator()&#10;        is UserUiState.Success -&gt; {&#10;            LazyColumn(modifier = Modifier.padding(16.dp)) {&#10;                items(s.users) { u -&gt;&#10;                    Text(&quot;${u.username} - ${u.email}&quot;)&#10;                }&#10;            }&#10;        }&#10;        is UserUiState.Error -&gt; Text(&quot;Error: ${s.message}&quot;)&#10;    }&#10;}&#10;&#10;@Composable&#10;fun CreateUserScreen(viewModel: UserViewModel = viewModel()) {&#10;    val name = remember { mutableStateOf(&quot;&quot;) }&#10;    val email = remember { mutableStateOf(&quot;&quot;) }&#10;    val clave = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(modifier = Modifier.padding(16.dp)) {&#10;        OutlinedTextField(value = name.value, onValueChange = { name.value = it }, label = { Text(&quot;Nombre&quot;) })&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        OutlinedTextField(value = email.value, onValueChange = { email.value = it }, label = { Text(&quot;Email&quot;) })&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        OutlinedTextField(value = clave.value, onValueChange = { clave.value = it }, label = { Text(&quot;Clave&quot;) })&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        Button(onClick = { viewModel.addUser(name.value, email.value, clave.value) }) {&#10;            Text(&quot;Crear usuario&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.ui.screen&#10;&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.level_up_app.ui.viewmodel.UserUiState&#10;import com.example.level_up_app.ui.viewmodel.UserViewModel&#10;&#10;@Composable&#10;fun UserListScreen(viewModel: UserViewModel = viewModel()) {&#10;    val state by viewModel.state.collectAsState()&#10;&#10;    LaunchedEffect(Unit) { viewModel.loadUsers() }&#10;&#10;    when (val s = state) {&#10;        is UserUiState.Idle -&gt; Text(&quot;Cargando usuarios...&quot;)&#10;        is UserUiState.Loading -&gt; CircularProgressIndicator()&#10;        is UserUiState.Success -&gt; {&#10;            LazyColumn(modifier = Modifier.padding(16.dp)) {&#10;                items(s.users) { u -&gt;&#10;                    Text(&quot;${u.name} - ${u.email}&quot;)&#10;                }&#10;            }&#10;        }&#10;        is UserUiState.Error -&gt; Text(&quot;Error: ${s.message}&quot;)&#10;    }&#10;}&#10;&#10;@Composable&#10;fun CreateUserScreen(viewModel: UserViewModel = viewModel()) {&#10;    val name = remember { mutableStateOf(&quot;&quot;) }&#10;    val email = remember { mutableStateOf(&quot;&quot;) }&#10;    val clave = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(modifier = Modifier.padding(16.dp)) {&#10;        OutlinedTextField(value = name.value, onValueChange = { name.value = it }, label = { Text(&quot;Nombre&quot;) })&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        OutlinedTextField(value = email.value, onValueChange = { email.value = it }, label = { Text(&quot;Email&quot;) })&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        OutlinedTextField(value = clave.value, onValueChange = { clave.value = it }, label = { Text(&quot;Clave&quot;) })&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        Button(onClick = { viewModel.addUser(name.value, email.value, clave.value) }) {&#10;            Text(&quot;Crear usuario&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/viewmodel/UserViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/viewmodel/UserViewModel.kt" />
              <option name="originalContent" value="package com.example.level_up_app.ui.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.level_up_app.data.model.User&#10;import com.example.level_up_app.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class UserUiState {&#10;    object Idle : UserUiState()&#10;    object Loading : UserUiState()&#10;    data class Success(val users: List&lt;User&gt;) : UserUiState()&#10;    data class Error(val message: String) : UserUiState()&#10;}&#10;&#10;class UserViewModel : ViewModel() {&#10;    private val repo = UserRepository()&#10;&#10;    private val _state = MutableStateFlow&lt;UserUiState&gt;(UserUiState.Idle)&#10;    val state: StateFlow&lt;UserUiState&gt; = _state.asStateFlow()&#10;&#10;    fun loadUsers() {&#10;        viewModelScope.launch {&#10;            _state.value = UserUiState.Loading&#10;            repo.getAllUsers()&#10;                .onSuccess { _state.value = UserUiState.Success(it) }&#10;                .onFailure { _state.value = UserUiState.Error(it.message ?: &quot;Error desconocido&quot;) }&#10;        }&#10;    }&#10;&#10;    fun addUser(name: String, email: String, clave: String, isAdmin: Boolean = false) {&#10;        viewModelScope.launch {&#10;            _state.value = UserUiState.Loading&#10;            repo.createUser(User(username = name, email = email, password = clave, isAdmin = isAdmin))&#10;                .onSuccess {&#10;                    // tras crear, refrescar lista&#10;                    loadUsers()&#10;                }&#10;                .onFailure { _state.value = UserUiState.Error(it.message ?: &quot;Error desconocido&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.ui.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.level_up_app.data.model.User&#10;import com.example.level_up_app.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class UserUiState {&#10;    object Idle : UserUiState()&#10;    object Loading : UserUiState()&#10;    data class Success(val users: List&lt;User&gt;) : UserUiState()&#10;    data class Error(val message: String) : UserUiState()&#10;}&#10;&#10;class UserViewModel : ViewModel() {&#10;    private val repo = UserRepository()&#10;&#10;    private val _state = MutableStateFlow&lt;UserUiState&gt;(UserUiState.Idle)&#10;    val state: StateFlow&lt;UserUiState&gt; = _state.asStateFlow()&#10;&#10;    fun loadUsers() {&#10;        viewModelScope.launch {&#10;            _state.value = UserUiState.Loading&#10;            repo.getAllUsers()&#10;                .onSuccess { _state.value = UserUiState.Success(it) }&#10;                .onFailure { _state.value = UserUiState.Error(it.message ?: &quot;Error desconocido&quot;) }&#10;        }&#10;    }&#10;&#10;    fun addUser(name: String, email: String, clave: String, isAdmin: Boolean = false) {&#10;        viewModelScope.launch {&#10;            _state.value = UserUiState.Loading&#10;            repo.createUser(User(name = name, email = email, clave = clave, isAdmin = isAdmin))&#10;                .onSuccess {&#10;                    // tras crear, refrescar lista&#10;                    loadUsers()&#10;                }&#10;                .onFailure { _state.value = UserUiState.Error(it.message ?: &quot;Error desconocido&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/menu/MainMenu.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/level_up_app/ui/menu/MainMenu.kt" />
              <option name="originalContent" value="package com.example.level_up_app.ui.menu&#10;&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Favorite&#10;import androidx.compose.material.icons.filled.ShoppingCart&#10;import androidx.compose.material.icons.outlined.FavoriteBorder&#10;import androidx.compose.material.icons.outlined.ShoppingCart&#10;import androidx.compose.material3.CenterAlignedTopAppBar&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import com.example.level_up_app.ui.catalog.CatalogScreen&#10;import com.example.level_up_app.ui.cart.CartScreen&#10;import com.example.level_up_app.ui.components.BottomNavBar&#10;import com.example.level_up_app.ui.news.NewsScreen&#10;import com.example.level_up_app.ui.profile.ProfileEditScreen&#10;import com.example.level_up_app.ui.profile.ProfileScreen&#10;import com.example.level_up_app.ui.main.HomeScreen&#10;import com.example.level_up_app.ui.favorites.FavoritesScreen&#10;import com.example.level_up_app.buys.PayScreen&#10;import com.example.level_up_app.buys.PayResultScreen&#10;import com.example.level_up_app.screen.Fondo_2&#10;import androidx.compose.ui.platform.LocalContext&#10;import com.example.level_up_app.utils.SessionManager&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MainMenu(&#10;    onProfile: () -&gt; Unit = {}&#10;) {&#10;    val context = LocalContext.current&#10;    val sessionManager = remember { SessionManager(context) }&#10;    var currentUser by remember { mutableStateOf(sessionManager.getUser()) }&#10;&#10;    var selectedIndex by remember { mutableStateOf(0) }&#10;    var isEditing by remember { mutableStateOf(false) }&#10;    // nuevo estado: resultado del último pago (null = aún no se ha hecho)&#10;    var lastPaymentSuccess by remember { mutableStateOf&lt;Boolean?&gt;(null) }&#10;    val currentScreen =&#10;&#10;        when (selectedIndex) {&#10;        0 -&gt; &quot;Inicio&quot;&#10;        1 -&gt; &quot;Catalogo&quot;&#10;        2 -&gt; &quot;Noticias&quot;&#10;        3 -&gt; &quot;Perfil&quot;&#10;        4 -&gt; &quot;Favoritos&quot;&#10;        5 -&gt; &quot;Carrito&quot;&#10;        6 -&gt; &quot;Pago&quot;&#10;        7 -&gt; &quot;Resultado pago&quot;&#10;        else -&gt; &quot;&quot;&#10;    }&#10;&#10;    Scaffold(&#10;&#10;        topBar = {&#10;            CenterAlignedTopAppBar(&#10;                title = { Text(currentScreen.uppercase()) },&#10;                actions = {&#10;                    IconButton(onClick = { selectedIndex = 4 }) {&#10;                        Icon(&#10;                            imageVector = if (selectedIndex == 4) Icons.Filled.Favorite else Icons.Outlined.FavoriteBorder,&#10;                            contentDescription = &quot;Favoritos&quot;&#10;                        )&#10;                    }&#10;                    IconButton(onClick = { selectedIndex = 5 }) {&#10;                        Icon(&#10;                            imageVector = if (selectedIndex == 5) Icons.Filled.ShoppingCart else Icons.Outlined.ShoppingCart,&#10;                            contentDescription = &quot;Carrito&quot;&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        },&#10;         // when user selects another tab, make sure we leave edit mode&#10;         bottomBar = { BottomNavBar(selectedIndex = selectedIndex, onItemSelected = { index -&gt;&#10;             selectedIndex = index&#10;             if (index != 3) isEditing = false&#10;         }, onProfile = onProfile) }&#10;&#10;    ) { innerPadding -&gt;&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(innerPadding)&#10;        ) {&#10;            Fondo_2()&#10;            when (selectedIndex) {&#10;                0 -&gt; HomeScreen()&#10;                1 -&gt; CatalogScreen()&#10;                2 -&gt; NewsScreen()&#10;                4 -&gt; FavoritesScreen()&#10;                5 -&gt; CartScreen(onNavigateToPay = { selectedIndex = 6 })&#10;                6 -&gt; PayScreen(&#10;                    onCancel = { selectedIndex = 0 },&#10;                    onSuccess = {&#10;                        lastPaymentSuccess = true&#10;                        selectedIndex = 7&#10;                    },&#10;                    onFailure = {&#10;                        lastPaymentSuccess = false&#10;                        selectedIndex = 7&#10;                    }&#10;                )&#10;                7 -&gt; PayResultScreen(&#10;                    isSuccess = (lastPaymentSuccess == true),&#10;                    onRetry = {&#10;                        // al reintentar limpiamos el estado y volvemos a la pantalla de pago&#10;                        lastPaymentSuccess = null&#10;                        selectedIndex = 6&#10;                    },&#10;                    onGoHome = {&#10;                        lastPaymentSuccess = null&#10;                        selectedIndex = 0&#10;                    }&#10;                )&#10;                3 -&gt; {&#10;                    if (isEditing) {&#10;                        ProfileEditScreen(&#10;                            onSave = { _, _, _ -&gt; /* no-op for now */ },&#10;                            onBack = {&#10;                                isEditing = false&#10;                                // Recargar los datos del usuario desde la sesión actualizada&#10;                                currentUser = sessionManager.getUser()&#10;                            }&#10;                        )&#10;                    } else {&#10;                        ProfileScreen(&#10;                            name = currentUser?.name ?: &quot;&quot;,&#10;                            email = currentUser?.email ?: &quot;&quot;,&#10;                            onEditClicked = { isEditing = true }&#10;                        )&#10;                    }&#10;                }&#10;                else -&gt; {&#10;                    Box(&#10;                        modifier = Modifier.fillMaxSize(),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&quot;Pantalla: $currentScreen&quot;)&#10;                    }&#10;                }&#10;            }&#10;         }&#10;     }&#10; }&#10;" />
              <option name="updatedContent" value="package com.example.level_up_app.ui.menu&#10;&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Favorite&#10;import androidx.compose.material.icons.filled.ShoppingCart&#10;import androidx.compose.material.icons.filled.Star&#10;import androidx.compose.material.icons.outlined.FavoriteBorder&#10;import androidx.compose.material.icons.outlined.ShoppingCart&#10;import androidx.compose.material3.CenterAlignedTopAppBar&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import com.example.level_up_app.ui.catalog.CatalogScreen&#10;import com.example.level_up_app.ui.cart.CartScreen&#10;import com.example.level_up_app.ui.components.BottomNavBar&#10;import com.example.level_up_app.ui.news.NewsScreen&#10;import com.example.level_up_app.ui.profile.ProfileEditScreen&#10;import com.example.level_up_app.ui.profile.ProfileScreen&#10;import com.example.level_up_app.ui.main.HomeScreen&#10;import com.example.level_up_app.ui.favorites.FavoritesScreen&#10;import com.example.level_up_app.buys.PayScreen&#10;import com.example.level_up_app.buys.PayResultScreen&#10;import com.example.level_up_app.screen.Fondo_2&#10;import androidx.compose.ui.platform.LocalContext&#10;import com.example.level_up_app.utils.SessionManager&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MainMenu(&#10;    onProfile: () -&gt; Unit = {}&#10;) {&#10;    val context = LocalContext.current&#10;    val sessionManager = remember { SessionManager(context) }&#10;    var currentUser by remember { mutableStateOf(sessionManager.getUser()) }&#10;&#10;    var selectedIndex by remember { mutableStateOf(0) }&#10;    var isEditing by remember { mutableStateOf(false) }&#10;    // nuevo estado: resultado del último pago (null = aún no se ha hecho)&#10;    var lastPaymentSuccess by remember { mutableStateOf&lt;Boolean?&gt;(null) }&#10;    val currentScreen =&#10;&#10;        when (selectedIndex) {&#10;        0 -&gt; &quot;Inicio&quot;&#10;        1 -&gt; &quot;Catalogo&quot;&#10;        2 -&gt; &quot;Noticias&quot;&#10;        3 -&gt; &quot;Perfil&quot;&#10;        4 -&gt; &quot;Favoritos&quot;&#10;        5 -&gt; &quot;Carrito&quot;&#10;        6 -&gt; &quot;Pago&quot;&#10;        7 -&gt; &quot;Resultado pago&quot;&#10;        else -&gt; &quot;&quot;&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            CenterAlignedTopAppBar(&#10;                title = { Text(currentScreen.uppercase()) },&#10;                navigationIcon = {&#10;                    // Menú de administrador (solo si es admin)&#10;                    if (currentUser?.isAdmin == true) {&#10;                        var showAdminMenu by remember { mutableStateOf(false) }&#10;                        &#10;                        IconButton(onClick = { showAdminMenu = true }) {&#10;                            Icon(&#10;                                imageVector = Icons.Filled.Star,&#10;                                contentDescription = &quot;Panel de Administración&quot;&#10;                            )&#10;                        }&#10;                        &#10;                        androidx.compose.material3.DropdownMenu(&#10;                            expanded = showAdminMenu,&#10;                            onDismissRequest = { showAdminMenu = false }&#10;                        ) {&#10;                            androidx.compose.material3.DropdownMenuItem(&#10;                                text = { Text(&quot;Administrar Productos&quot;) },&#10;                                onClick = {&#10;                                    showAdminMenu = false&#10;                                    // TODO: Navegar a administración de productos&#10;                                }&#10;                            )&#10;                            androidx.compose.material3.DropdownMenuItem(&#10;                                text = { Text(&quot;Administrar Usuarios&quot;) },&#10;                                onClick = {&#10;                                    showAdminMenu = false&#10;                                    // TODO: Navegar a administración de usuarios&#10;                                }&#10;                            )&#10;                            androidx.compose.material3.DropdownMenuItem(&#10;                                text = { Text(&quot;Administrar Noticias&quot;) },&#10;                                onClick = {&#10;                                    showAdminMenu = false&#10;                                    // TODO: Navegar a administración de noticias&#10;                                }&#10;                            )&#10;                        }&#10;                    }&#10;                },&#10;                actions = {&#10;                    IconButton(onClick = { selectedIndex = 4 }) {&#10;                        Icon(&#10;                            imageVector = if (selectedIndex == 4) Icons.Filled.Favorite else Icons.Outlined.FavoriteBorder,&#10;                            contentDescription = &quot;Favoritos&quot;&#10;                        )&#10;                    }&#10;                    IconButton(onClick = { selectedIndex = 5 }) {&#10;                        Icon(&#10;                            imageVector = if (selectedIndex == 5) Icons.Filled.ShoppingCart else Icons.Outlined.ShoppingCart,&#10;                            contentDescription = &quot;Carrito&quot;&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        },&#10;         // when user selects another tab, make sure we leave edit mode&#10;         bottomBar = { BottomNavBar(selectedIndex = selectedIndex, onItemSelected = { index -&gt;&#10;             selectedIndex = index&#10;             if (index != 3) isEditing = false&#10;         }, onProfile = onProfile) }&#10;&#10;    ) { innerPadding -&gt;&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(innerPadding)&#10;        ) {&#10;            Fondo_2()&#10;            when (selectedIndex) {&#10;                0 -&gt; HomeScreen()&#10;                1 -&gt; CatalogScreen()&#10;                2 -&gt; NewsScreen()&#10;                4 -&gt; FavoritesScreen()&#10;                5 -&gt; CartScreen(onNavigateToPay = { selectedIndex = 6 })&#10;                6 -&gt; PayScreen(&#10;                    onCancel = { selectedIndex = 0 },&#10;                    onSuccess = {&#10;                        lastPaymentSuccess = true&#10;                        selectedIndex = 7&#10;                    },&#10;                    onFailure = {&#10;                        lastPaymentSuccess = false&#10;                        selectedIndex = 7&#10;                    }&#10;                )&#10;                7 -&gt; PayResultScreen(&#10;                    isSuccess = (lastPaymentSuccess == true),&#10;                    onRetry = {&#10;                        // al reintentar limpiamos el estado y volvemos a la pantalla de pago&#10;                        lastPaymentSuccess = null&#10;                        selectedIndex = 6&#10;                    },&#10;                    onGoHome = {&#10;                        lastPaymentSuccess = null&#10;                        selectedIndex = 0&#10;                    }&#10;                )&#10;                3 -&gt; {&#10;                    if (isEditing) {&#10;                        ProfileEditScreen(&#10;                            onSave = { _, _, _ -&gt; /* no-op for now */ },&#10;                            onBack = {&#10;                                isEditing = false&#10;                                // Recargar los datos del usuario desde la sesión actualizada&#10;                                currentUser = sessionManager.getUser()&#10;                            }&#10;                        )&#10;                    } else {&#10;                        ProfileScreen(&#10;                            name = currentUser?.name ?: &quot;&quot;,&#10;                            email = currentUser?.email ?: &quot;&quot;,&#10;                            onEditClicked = { isEditing = true }&#10;                        )&#10;                    }&#10;                }&#10;                else -&gt; {&#10;                    Box(&#10;                        modifier = Modifier.fillMaxSize(),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&quot;Pantalla: $currentScreen&quot;)&#10;                    }&#10;                }&#10;            }&#10;         }&#10;     }&#10; }&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>